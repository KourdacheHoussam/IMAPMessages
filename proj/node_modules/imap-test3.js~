var inbox = require("inbox");

var client = inbox.createConnection(false, "imap.gmail.com", {
	secureConnection: true,
	auth:{
		user: "pnom25446@gmail.com",
		pass: "kangourou17"
	}
});

client.connect();
list_mailboxes();
list_messages("Truc");

function list_mailboxes() 
{

	client.on("connect", function() {
		client.listMailboxes(function(err, mailboxes) {
			for (var i in mailboxes) {
				console.log(mailboxes[i].path);
				if (mailboxes[i].hasChildren) {
					mailboxes[i].listChildren(function(err, childs) {
						for (var j in childs) {
							console.log(childs[j].path);
						}
					});
				}
			}
		});
	});
}

client.on("close", function() {
});

function list_messages(mailbox) 
{
	client.on("connect", function() {
		client.openMailbox(mailbox, function(error, info){
			if(error) throw error;

			client.listMessages(-10, function(err, messages){
				messages.forEach(function(message){
					console.log(message.UID + ": " + message.title);
				});
			});

		});
	});
}
